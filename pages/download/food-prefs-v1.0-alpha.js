/**
 ** Copyright (C) 2025 Brianna Rainey
 ** This program is free software: you can redistribute it and/or modify
 ** it under the terms of the GNU General Public License as published by
 ** the Free Software Foundation, either version 3 of the License, or
 ** (at your option) any later version.
 **
 ** This program is distributed in the hope that it will be useful,
 ** but WITHOUT ANY WARRANTY; without even the implied warranty of
 ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 ** GNU General Public License for more details.
 **
 ** You should have received a copy of the GNU General Public License
 ** along with this program.  If not, see <https://www.gnu.org/licenses/>.
 **
 ** v1.0-alpha
 **/
!(function(){'use strict';var t='Food Prefs',n='1.0-alpha',e=function(){return e=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},e.apply(this,arguments)};function i(t,n,e){if(e||2===arguments.length)for(var i,r=0,o=n.length;r<o;r++)!i&&r in n||(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return t.concat(i||Array.prototype.slice.call(n))}var r={5:'drink',6:'burger',7:'chips',8:'ice_cream',9:'candyfloss',13:'pizza',15:'popcorn',16:'hot_dog',17:'tentacle',19:'toffee_apple',21:'doughnut',22:'coffee',24:'chicken',25:'lemonade',35:'pretzel',36:'chocolate',37:'iced_tea',38:'funnel_cake',40:'beef_noodles',41:'fried_rice_noodles',42:'wonton_soup',43:'meatball_soup',44:'fruit_juice',45:'soybean_milk',46:'sujeonggwa',47:'sub_sandwich',48:'cookie',52:'roast_sausage'},o=Object.getOwnPropertyNames(r).map(Number),a=[5,22,25,37,44,45,46],s=new(Array.bind.apply(Array,i([void 0],['beef_noodles','burger','candyfloss','chicken','chips','chocolate','cookie','doughnut','hot_dog','fried_rice_noodles','funnel_cake','ice_cream','meatball_soup','pizza','popcorn','pretzel','roast_sausage','sub_sandwich','tentacle','toffee_apple','wonton_soup','coffee','drink','fruit_juice','iced_tea','lemonade','soybean_milk','sujeonggwa'],!1))),u='[0m',c=(function(){function e(t,n){this.name=t,this.verbosity=n,this.prefix='\r[Food Prefs '.concat(this.name)}return e.prototype.verbose=function(t){},e.prototype.debug=function(t){},e.prototype.info=function(t){},e.prototype.warn=function(t){console.log(''.concat(this.prefix,' ').concat('[33m','WARN').concat(u,'] ').concat(t))},e.prototype.error=function(e){console.log(''.concat(t,' v').concat(n,' ').concat(this.name,' ').concat('[31m','ERROR').concat(u,'] ').concat(e))},e})();function h(t,n){return t.some(function(t){return t==n})}function l(t){return t[context.getRandom(0,t.length)]}function f(t){var n=[];return objectManager.getAllObjects('ride').filter(function(t){return 255!=t.shopItem}).forEach(function(e){h(o,e.shopItem)&&('scenario'===t||'researched'===t&&park.research.isObjectResearched('ride',e.index))&&n.push(r[e.shopItem])}),n}var d=new c('guests',0);function p(t){return!(null===t||null===t.id||!t.items)}function g(t,n){t.destination=n}function v(t,n){t.direction=n}function y(t){if(0==t.items.length)return!1;var n=t.items[0];return'voucher'===n.type&&'food_drink_free'===n.voucherType&&n.item}var w=new c('stalls',0),b=(function(){function t(n,e){this.customers={},this.fresh=!1,this.currentTick=0,this.cheats={},this.pingInterval=n,this.stalls=t.findStalls(e),this.fresh=!0}return t.prototype.newDay=function(n,e){var i=this;Object.assign(this.cheats,e),void 0===this.activePing?(this.fresh||(this.stalls=t.findStalls(),this.fresh=!0),this.activePing=context.subscribe('interval.tick',function(){i.newTick(n)})):w.warn('ping interval is too high. ignoring this day')},t.prototype.newTick=function(t){void 0!==this.activePing?(this.pingStalls(t),this.currentTick+=1,this.currentTick>this.pingInterval&&(this.activePing.dispose(),this.activePing=void 0,this.currentTick=0,this.customers={},w.debug('done pinging'))):w.error('tick without ticking? shouldn\'t be possible')},t.findStalls=function(t){for(var n=t||map,i=[],r=function(t){if(!o.some(function(n){return n===t.object.shopItem}))return'continue';var r=t.stations[0].start,a=(function(t,e){var i=n.getTile(Math.floor(e.x/32),Math.floor(e.y/32)).elements.filter(function(n){return'track'==n.type&&n.ride==t.id});return 1==i.length?i[0].direction:-1})(t,r);if(-1==a)return w.error('tile direction not found ('.concat(r.x,', ').concat(r.y,'). stall will be ignored')),'continue';i.push([t,e(e({},r),{direction:a})])},a=0,s=n.rides.filter(function(t){return'stall'===t.classification&&'open'===t.status});a<s.length;a++)r(s[a]);return i},t.findCustomers=function(t,n,e,i){var o=(function(t){var n;switch(t.direction){case 0:n=map.getAllEntitiesOnTile('guest',map.getTile(t.x-1,t.y));break;case 1:n=map.getAllEntitiesOnTile('guest',map.getTile(t.x,t.y+32+1));break;case 2:n=map.getAllEntitiesOnTile('guest',map.getTile(t.x+32+1,t.y));break;case 3:n=map.getAllEntitiesOnTile('guest',map.getTile(t.x,t.y-1));break;default:return[]}return n.filter(function(n){return p(n)&&n.z==t.z})})(e);w.verbose('found '.concat(o.length,' guests next to ').concat(n.id));for(var a={},u=0,c=o;u<c.length;u++){var g=c[u];a[g.id]={guest:g,originalHunger:g.hunger,originalThirst:g.thirst}}!(function(t,n){for(var e=f('scenario'),i=Object.keys(t).map(Number),r=0,o=n;r<o.length;r++){var a=o[r];if(!h(i,a.id)){var s=y(a),u=s||l(e);t[a.id]=u,d.verbose(''.concat(a.name,' (').concat(a.id,') assigned ').concat(u).concat(s?' due to a voucher':''))}}})(t,o);for(var v=r[n.object.shopItem],b=function(n){return i.guestsIgnoreFavourite?!i.guestsOnlyLike||v===i.guestsOnlyLike:t[n.id]===v},m=function(t){return s.some(function(n){return t.hasItem({type:n})})},k=0,x=o;k<x.length;k++){var I=x[k];(I.happiness<41||I.getFlag('leavingPark')||!b(I)||m(I))&&delete a[I.id]}return w.verbose(''.concat(Object.keys(a).length,' guests are intrigued by ').concat(n.id)),a},t.prototype.updateStalls=function(){w.info('marking stall cache as unfresh for future updating'),this.fresh=!1},t.prototype.pingStalls=function(n){for(var i=function(i){var s=o.stalls[i],u=s[0],c=s[1],h=r[u.object.shopItem];if(0==o.currentTick){w.debug('pinging stall: '.concat(h,' id').concat(u.id,' @ ').concat(c.x,', ').concat(c.y,', ').concat(c.z,', ').concat(c.direction));var l=t.findCustomers(n,u,c,o.cheats);o.customers[u.id]=e({},l)}var f={x:c.x,y:c.y};switch(c.direction){case 0:f.x+=32,f.y+=16;break;case 1:f.x+=16,f.y+=16;break;case 2:f.x-=32,f.y+=16;break;case 3:f.x+=16,f.y+=2}for(var d=0,p=Object.keys(o.customers[u.id]);d<p.length;d++){var y=p[d],b=o.customers[u.id][Number(y)];o.currentTick==o.pingInterval/2?a.some(function(t){return t==u.object.shopItem})?b.guest.thirst=50:b.guest.hunger=50:o.currentTick==o.pingInterval&&(b.guest.hunger=b.originalHunger,b.guest.thirst=b.originalThirst),v(b.guest,c.direction+(c.direction<2?2:-2)),g(b.guest,f)}},o=this,s=0;s<this.stalls.length;s++)i(s)},t})(),m=function(t,n){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},m(t,n)};function k(t,n){if('function'!=typeof n&&null!==n)throw new TypeError('Class extends value '+n+' is not a constructor or null');function e(){this.constructor=t}m(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}function x(t){return void 0===t}function I(t){return null===t}function O(t){return Array.isArray(t)}function S(t){return C(t,'function')}function T(t){return C(t,'number')}function _(t){return C(t,'object')}function P(t){return C(t,'string')}function C(t,n){return typeof t===n}var F='redraw',j=[4,0],z=[1,2],H=[0,0],A={top:H,right:H,bottom:H,left:H};function G(t){x(t.height)&&(t.height=14)}var L=Math.floor(1048575*Math.random())<<10;function E(){return(L++).toString(36)}function M(t,n){return t.subscribe(n)}var N=function(t,n,e,i){this.Ia=t,this.Ja=n,this.Ka=e,this.La=M(n,i)};function R(t){if(!t||!_(t))return!1;var n=t;return S(n.get)&&S(n.subscribe)}function V(t){return!(!t||!_(t))&&!(!(n=t.twoway)||!_(n))&&R(n)&&S(n.set);var n}function U(t){return V(t)?t.twoway:t}var B=(function(){function t(){this.Ma=[],this.za=null}return t.prototype.add=function(t,n,e,i){this.on(t,e,function(t,e){var r=i?i(e):e;t[n]=r})},t.prototype.callback=function(t,n,e,i,r){V(e)?t[n]=function(t,n){var o=r?r(t,n):t;e.twoway.set(o),i&&i(o)}:i&&(t[n]=r?function(t,n){return i(r(t,n))}:i)},t.prototype.twoway=function(t,n,e,i,r){this.add(t,n,i),this.callback(t,e,i,r)},t.prototype.on=function(t,n,e){var i=U(n);if(R(i)){var r=this.Aa(t,i,e);this.Ma.push(r),e(t,i.get())}else x(i)||e(t,i)},t.prototype.Na=function(){this.za=null},t.prototype.Oa=function(){return this.Ma.length>0},t})(),D=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return k(n,t),n.prototype.ya=function(t){var n=t.ga;n&&this.Ba(n),this.za=t},n.prototype.Aa=function(t,n,e){var i=this;return new N('',n,e,function(t){var n=i.za;n&&n.ua&&e(n.ua,t)})},n.prototype.Ba=function(t){var n=this.Ma;if(n)for(var e=0,i=n;e<i.length;e++){var r=i[e];r.Ka(t,r.Ja.get())}},n})(B);function W(t,n){n||(n={});for(var e=0,i=t;e<i.length;e++){var r=i[e],o=r.name;o&&!(o in n)&&(n[o]=r)}return n}function J(t){return q(t,0)}function K(t){return q(t,1)}function Q(t){return q(t,2)}function q(t,n){return t[1]===n}function X(t){throw Error(t)}function Y(t){if(x(t))return t;if(T(t))return[t,0];var n=t.trim(),e=n.length;if(e>1){var i=e-1,r=void 0,o=n[i];if('w'===o?r=2:'%'===o?r=1:e>2&&(i--,'x'===o&&'p'===n[i]&&(r=0)),!x(r))return[parseFloat(n.substring(0,i)),r]}X('Value \''+t+'\' is not a valid scale.')}function Z(t,n){return Y(t)||n}function $(t){return Z(t,H)}function tt(t,n,e,i){switch(t[1]){case 2:return(e?t[0]/e:1)*n*(100-i)*.01;case 1:return.01*t[0]*n;default:return t[0]}}var nt=['y','x'],et=['height','width'],it=['top','left'],rt=['bottom','right'];function ot(t,n,e,i){var r=et[n],o=i[it[n]],a=i[rt[n]],s=t[r]-st(e,o,a,J),u=st(e,o,a,K),c=st(e,o,a,Q),h=tt(e,s,c,u);return t[r]=h,at(t,n,i,s,c,u)}function at(t,n,e,i,r,o){return(function(t,n,e,i,r,o,a,s,u){var c=tt(n[s],e,i,r),h=tt(n[u],e,i,r);return t[o]+=c,c+t[a]+h})(t,e,i,r,o,nt[n],et[n],it[n],rt[n])}function st(t,n,e,i){var r=0;return i(t)&&(r+=t[0]),i(n)&&(r+=n[0]),i(e)&&(r+=e[0]),r}var ut='inherit',ct='auto',ht=['minHeight','minWidth'],lt=['maxHeight','maxWidth'];function ft(t,n,e){if(P(e))return ct;var i=e,r=i.value||e;return pt(t,n,r,i.min||r,i.max||r),r}function dt(t,n,e,i,r){var o=et[n],a=i[it[n]],s=i[rt[n]],u=e[o]+a[0]+s[0]+r;return J(a)&&J(s)||X('Padding for '+o+' must be absolute for auto window resize.'),pt(t,n,u,u,u),u}function pt(t,n,e,i,r){t[et[n]]=e,t[ht[n]]=i,t[lt[n]]=r}var gt=(function(){function t(t){var n=this,e=t.width,i=t.height,r=t.position,o=new D,a={classification:'fui-'+E(),title:'',colours:t.colours,onUpdate:function(){n.ha(),n.c(function(t){return t.update()})},onClose:function(){n.m()}},s=ft(a,1,e),u=ft(a,0,i);this.qa(s,u),o.add(a,'title',t.title),this.ea=o.Oa()?o:null,this.fa=r,this.ga=a}return t.prototype.ha=function(){var t=this.ua,n=this.t,e=this.w;if(t&&n){if(!(4&e)){var i=t.width,r=t.height,o=2&e||this.ra==i,a=1&e||this.sa==r;if(o&&a)return;this.ra=i,this.sa=r}this.d(t,n),this.w&=-5}},t.prototype.ma=function(t,n){return{x:0,y:n,width:2&t?ct:this.ra,height:1&t?ct:this.sa-n}},t.prototype.na=function(t,n,e,i){var r=this.w;2&r&&(this.ra=dt(t,1,n,i,0)),1&r&&(this.sa=dt(t,0,n,i,e))},t.prototype.qa=function(t,n){var e=this.w;t==ct?e|=2:(e&=-3,this.ra=t),n==ct?e|=1:(e&=-2,this.sa=n),this.w=e},t.prototype.l=function(t,n){this.d(t,this.a),(function(t,n){n&&'default'!==n&&('center'===n?(t.x=ui.width/2-t.width/2,t.y=ui.height/2-t.height/2):(t.x=n.x,t.y=n.y))})(t,this.fa),n&&n.ya(this);var e=ui.openWindow(t),i=W(e.widgets);this.ua=e,this.t=i,this.c(function(t){return t.open(e,i)})},t.prototype.m=function(){this.c(function(t){return t.close()});var t=this.ea;t&&t.Na(),this.ua=null,this.t=null},t.prototype.open=function(){if(this.ua)this.focus();else{var t=this.ga,n=this.ea;this.l(t,n)}},t.prototype.close=function(){this.ua&&this.ua.close()},t.prototype.focus=function(){this.ua&&this.ua.bringToFront()},t.prototype.redraw=function(){this.w|=4},t})(),vt=function(t,n){this.position=t.parse(n),this.xa=t};function yt(t){return(wt(t.width)?1:0)|(wt(t.height)?2:0)}function wt(t){return x(t)||t===ct}function bt(t,n,e,i,r){return mt(t,n,function(t){return(function(t,n,e,i){var r,o,a=e===i,s=0;if(a&&!J(n))return null;for(var u=et[i],c=it[i],h=rt[i],l=-1,f=0,d=t;f<d.length;f++){var p=d[f],g=p.position,v=g[u],y=g.padding,w=y[c],b=y[h];if(!xt(v,w,b))return null;p.skip||(r=s,o=v[0]+w[0]+b[0],s=a?r+o:r<o?o:r,l++)}return a&&(s+=n[0]*l),s})(e,i,r,t)})}function mt(t,n,e){return!!(3&n&&kt(t,1&n,1,e)|kt(t,2&n,0,e))}function kt(t,n,e,i){var r;if(n&&!I(r=i(e))){var o=et[e],a=t[o];if(a[0]!==r||!J(a))return t[o]=[r,0],1}return 0}function xt(t,n,e){return J(t)&&J(n)&&J(e)}function It(t,n,e,i,r){var o=t.length;if(o)for(var a=1==e?0:1,s=(function(t,n,e,i){var r=t.length,o={S:Array(r),H:0,T:0,D:0};Ot(n,o,r-1);for(var a=0;a<r;a++){var s=t[a],u=s.padding,c={R:s[et[e]],rr:s[et[i]],h:u};o.S[a]=c;var h=c.R,l=c.h[it[e]],f=c.h[rt[e]];Ot(h,o,1),Ot(l,o,1),Ot(f,o,1)}return o})(t,i,e,a),u=n[et[e]]-s.H,c=s.D,h=s.T,l=tt(i,u,c,h),f=0,d=0;d<o;d++){var p=s.S[d],g=f+n[nt[e]],v=tt(p.R,u,c,h),y=p.h,w={};w[nt[e]]=g,w[et[e]]=v,w[nt[a]]=n[nt[a]],w[et[a]]=n[et[a]],f+=at(w,e,y,u,c,h),ot(w,a,p.rr,y),r(d,w),f+=l}}function Ot(t,n,e){var i=t[0]*e;Q(t)?n.D+=i:J(t)?n.H+=i:K(t)&&(n.T+=i)}function St(t,n){var e;if(n||(n=A),x(t))e=t;else if(O(t)){var i=t.length;if(2===i){var r=$(t[0]),o=$(t[1]);e=_t(r,o,r,o)}else 4===i?e=_t($(t[0]),$(t[1]),$(t[2]),$(t[3])):X('Padding array of unknown length: '+i+'. Only lengths of 2 or 4 are supported.')}else if(_(t))e=_t(Tt(it[0],t,n),Tt(rt[1],t,n),Tt(rt[0],t,n),Tt(it[1],t,n));else{var a=$(t);e=_t(a,a,a,a)}return e||n}function Tt(t,n,e){var i=n[t];return Z(x(i)?n.rest:i,e[t])}function _t(t,n,e,i){return{top:t,right:n,bottom:e,left:i}}function Pt(t,n){return{width:Z(t.width,z),height:Z(t.height,z),padding:St(t.padding,n)}}function Ct(t){return t.direction=1,jt(t)}function Ft(t){return t.direction=0,jt(t)}function jt(t){return function(n,e){return new zt(n,e,t)}}var zt=(function(t){function n(n,e,i){var r=t.call(this,n,i)||this;r.parse=Pt,r.L=i.direction||0,r.M=Y(i.spacing)||j;for(var o=yt(i),a=O(i)?i:i.content,s=a.length,u=Array(s),c=0;c<s;c++){var h=a[c];u[c]=h(r,e)}return r.w=4|o,r.v=u,e.on(F,function(){var t=r.w;if(4&t){r.w&=-5;var n=r.v,e=n.filter(function(t){return!t.skip});bt(r.position,t,n,r.M,r.L),r.N=e,r.O=e.map(function(t){return t.position})}}),r}return k(n,t),n.prototype.recalculate=function(){this.w|=4,3&this.w&&this.xa.recalculate()},n.prototype.layout=function(t,n){var e=this;It(this.O,n,this.L,this.M,function(n,i){e.N[n].layout(t,i)})},n})(vt),Ht=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return k(n,t),n.prototype.ya=function(t){var n=t.Fa;n&&this.Ba(n),this.za=t},n.prototype.Aa=function(t,n,e){var i=this,r=t.name||(t.name=E());return new N(r,n,e,function(t){var n=i.za;if(n&&n.isOpen()){var o=n.getWidget(r);o&&e(o,t)}})},n.prototype.Ba=function(t){var n=this.Ma;if(n)for(var e=0,i=n;e<i.length;e++){var r=i[e];r.Ka(t[r.Ia],r.Ja.get())}},n})(B);function At(t,n){for(var e=0,i=t.length;e<i;e++)t[e](n)}var Gt=(function(){function t(t,n,e,i,r,o,a){this.width=t,this.height=n,this.xa=e,this.l=i,this.Ca=r,this.Da=o,this.m=a,this.recalculate=this.redraw}return t.prototype.layout=function(t,n){At(this.Da,this);var e=this.j,i=e.position,r=Lt(t,this.width,i,1),o=Lt(t,this.height,i,0);return e.layout(n,t),{width:r,height:o}},t.prototype.redraw=function(){this.Fa&&this.xa.redraw()},t.prototype.parse=function(t){return{width:z,height:z,h:St(t.padding)}},t.prototype.getWidget=function(t){var n,e=this.Fa;return e&&(n=e[t]),n||null},t.prototype.isOpen=function(){return!!this.Fa},t.prototype.open=function(t,n){ft(t,1,this.width),ft(t,0,this.height),this.Fa=n;var e=this.B;e&&e.ya(this),At(this.l,this)},t.prototype.update=function(){At(this.Ca,this)},t.prototype.close=function(){At(this.m,this);var t=this.B;t&&t.Na(),this.Fa=void 0},t})();function Lt(t,n,e,i){var r=et[i],o=t[r],a=e[r],s=e.h,u=n==ut;return u&&o==ct||n==ct?(J(a)||X('Window body '+r+' must resolve to absolute size for "auto" window size.'),a[0]+(function(t,n,e){var i=n[it[e]],r=n[rt[e]];return J(i)&&J(r)||X('Window padding must be absolute for "auto" window size.'),t[nt[e]]+=i[0],i[0]+r[0]})(t,s,i)):(ot(t,i,a,s),u?o:a[0])}var Et=(function(){function t(t,n,e){this.va=[];var i=[],r=[],o=[],a=[],s=new Gt(e.width||ut,e.height||ut,t,i,r,o,a),u=new Ht,c=n.onOpen,h=n.onUpdate,l=n.onClose;this.open=i,this.update=r,this.redraw=o,this.close=a,this.binder=u,this.context=s,s.j=new zt(s,this,e),s.B=u.Oa()?u:null,c&&i.push(c),h&&r.push(h),l&&a.push(l)}return t.prototype.add=function(t){this.va.push(t)},t.prototype.on=function(t,n){this[t].push(n)},t})(),Mt=(function(t){function n(n){var e=t.call(this,n)||this,i=new Et(e,n,n),r=i.va;return e.ga.widgets=r,e.a=W(r),e.b=i.context,e}return k(n,t),n.prototype.c=function(t){t(this.b)},n.prototype.d=function(t,n){var e=this.ma(this.w,15),i=this.b.layout(e,n);this.na(t,i,15,A)},n})(gt),Nt=(function(){function t(t){this.U=t}return t.prototype.get=function(){return this.U},t.prototype.subscribe=function(t){this.Ga?this.Ga.push(t):this.Ga=[t];var n=this.Ga;return function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}},t.prototype.Ha=function(t){this.Ga&&At(this.Ga,t)},t})(),Rt=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return k(n,t),n.prototype.set=function(t){this.U!==t&&(this.U=t,this.Ha(t))},n})(Nt);function Vt(t){return new Rt(t)}function Ut(t){return R(t)?t.get():t}var Bt=Array.prototype.slice;function Dt(){for(var t=arguments,n=Bt.call(t,0,-1),e=n.length,i=t[e],r=Vt(Wt(n,i)),o=0;o<e;)M(n[o++],function(){var t=Wt(n,i);return r.set(t)});return r}function Wt(t,n){var e=t.map(function(t){return t.get()});return n.apply(void 0,e)}var Jt=Math.round;function Kt(t,n,e){var i=t[n];i.x=Jt(e.x),i.y=Jt(e.y),i.width=Jt(e.width-.1),i.height=Jt(e.height-.1)}var Qt=(function(t){function n(n,e,i,r){var o=t.call(this,e,r)||this;o.name=E(),o.type=n,o.x=o.y=o.width=o.height=0;var a=i.binder,s=i.context,u=r.visibility;return a.add(o,'tooltip',r.tooltip),a.add(o,'isDisabled',r.disabled),a.add(o,'isVisible',u,function(t){return'visible'===t}),(function(t,n){R(t)?(M(t,n),n(t.get())):x(t)||n(t)})(u,function(t){var n=o.skip,i='none'===t;o.skip=i,(n||i)&&(e.recalculate(),s.redraw())}),i.add(o),o}return k(n,t),n.prototype.layout=function(t,n){Kt(t,this.name,n)},n})(vt);function qt(t){return function(n,e){return new Xt(n,e,t)}}var Xt=(function(t){function n(n,e,i){var r,o=this,a='groupbox',s='content',u=yt(i);if(s in i){o=t.call(this,a,n,e,i)||this,r=i[s];var c=e.binder,h=i.text;c.add(o,'text',h),u|=h?8:0}else o=t.call(this,a,n,e,{})||this,r=i;o.w=4|u;var l=r(o,e);return o.z=l,e.on(F,function(){4&o.w&&(o.w&=-5,(function(t,n,e){mt(t,n,function(t){return(function(t,n){var e=t[et[n]],i=t.padding,r=i[it[n]],o=i[rt[n]];return xt(e,r,o)?e[0]+r[0]+o[0]:null})(e,t)})})(o.position,o.w,o.z.position))}),o}return k(n,t),n.prototype.parse=function(t){var n=St(6);return 8&this.w&&(n.top=[15,0]),Pt(t,n)},n.prototype.recalculate=function(){this.w|=4,3&this.w&&this.xa.recalculate()},n.prototype.layout=function(n,e){var i=8&this.w?0:4;e.y-=i,e.height+=i,t.prototype.layout.call(this,n,e),e.y+=i,e.height-=i;var r=this.z,o=r.position;(function(t,n,e,i){ot(t,1,n,i),ot(t,0,e,i)})(e,o.width,o.height,o.padding),r.layout(n,e)},n})(Qt);function Yt(t){return G(t),function(n,e){return new Zt(n,e,t)}}var Zt=(function(t){function n(n,e,i){var r=t.call(this,'checkbox',n,e,i)||this,o=e.binder;return o.add(r,'text',i.text),o.twoway(r,'isChecked','onChange',i.isChecked,i.onChange),r}return k(n,t),n.prototype.layout=function(n,e){e.y+=1,t.prototype.layout.call(this,n,e)},n})(Qt);function $t(t){return G(t),function(n,e){return new tn(n,e,t)}}var tn=(function(t){function n(n,e,i){var r=t.call(this,'dropdown',n,e,i)||this;r.items=[],r.selectedIndex=0;var o,a=i.items,s=i.disabled,u=i.disabledMessage,c=i.onChange,h='empty'===(o=i.autoDisable)?0:'single'===o?1:-1,l=i.selectedIndex,f=function(t){r.C(t,Ut(a),Ut(s),h,u)},d=e.binder,p=f;R(a)&&(p=function(t,n){f(t),r.F(t,n),r.A=n}),d.on(r,a,p),d.on(r,l,function(t,n){r.G=n,f(t)}),d.on(r,s,f);var g=(function(t,n,e){return n?function(i){t.E||(e?e(i,n):n(i))}:n})(r,c,function(t,n){return n(t<0?0:t)});return d.callback(r,'onChange',l,g),r}return k(n,t),n.prototype.C=function(t,n,e,i,r){this.E=!0;var o=e||!n||n.length<=i;o&&r?t.items=[r]:(t.items=n,t.selectedIndex=this.G||0),t.isDisabled=o,this.E=!1},n.prototype.F=function(t,n){var e=this.A;if(e){var i=e[t.selectedIndex||0],r=n.indexOf(i);r<0&&(r=0),this.G!==r&&(this.G=r,t.selectedIndex=r)}},n})(Qt);function nn(t){var n,e,i,r=0;if('content'in t){n=t.content,e=t.gap,i=t.spacing;var o=t.direction;x(o)||(r=o)}else n=t;var a=t,s={content:n,direction:r,spacing:i,padding:e};return a.content=function(t,n){return new zt(t,n,s)},function(t,n){return new Xt(t,n,a)}}function en(t){return function(n,e){return new on(n,e,t)}}var rn,on=(function(t){function n(n,e,i){var r=t.call(this,'listview',n,e,i)||this,o=i.selectedCell,a=i.onClick,s=e.binder;s.add(r,'items',i.items),s.add(r,'selectedCell',o),s.callback(r,'onClick',o,a&&function(t){t&&a(t.row,t.column)},function(t,n){var e=Ut(r.P);return e&&e.row==t&&e.column==n?e:{row:t,column:n}}),r.showColumnHeaders=!x(i.columns),r.scrollbars=i.scrollbars,r.canSelect=i.canSelect,r.isStriped=i.isStriped,r.onHighlight=i.onHighlight,r.P=U(o);var u=i.columns;if(r.columns=u,!u)return r;for(var c,h,l,f=u.length,d=Array(f),p=-1,g=!1,v=0;v<f;v++){if(P(c=u[v]))u[v]={header:c},h=z;else{var y=c.tooltip,w=c.ratioWidth,b=c.width;h=x(b)&&!x(w)?[w,2]:Z(b,z),y&&(c.headerTooltip=y)}l=h[1],d[v]=h,g||(g=p!=l&&-1!=p),p=l}if(g||1==p)return r.Q=d.map(function(t){return{width:t,height:H,padding:A}}),r;for(v=0;v<f;v++){var m=u[v];b=d[v],0==p?m.width=b[0]:(m.width=void 0,m.ratioWidth=b[0])}return r}return k(n,t),n.prototype.layout=function(n,e){var i=this,r=this.Q;if(r){var o=n[this.name];this.Q&&o.width!==e.width&&(It(r,e,1,H,function(t,n){i.columns[t].width=Jt(n.width)}),o.columns=this.columns,o.width=e.width),o.x=e.x,o.y=e.y,o.height=e.height}else t.prototype.layout.call(this,n,e)},n})(Qt);!(function(t){t[t.Gridlines=128]='Gridlines',t[t.UndergroundInside=1]='UndergroundInside',t[t.HideBase=4096]='HideBase',t[t.HideVertical=8192]='HideVertical',t[t.SoundOn=1024]='SoundOn',t[t.LandOwnership=256]='LandOwnership',t[t.ConstructionRights=512]='ConstructionRights',t[t.InvisibleEntities=16384]='InvisibleEntities',t[t.ClipView=131072]='ClipView',t[t.HighlightPathIssues=262144]='HighlightPathIssues',t[t.TransparentBackground=524288]='TransparentBackground',t[t.LandHeights=16]='LandHeights',t[t.TrackHeights=32]='TrackHeights',t[t.PathHeights=64]='PathHeights',t[t.SeeThroughRides=2]='SeeThroughRides',t[t.SeeThroughVehicles=1048576]='SeeThroughVehicles',t[t.SeeThroughVegetation=2097152]='SeeThroughVegetation',t[t.SeeThroughScenery=4]='SeeThroughScenery',t[t.SeeThroughPaths=65536]='SeeThroughPaths',t[t.SeeThroughSupports=8]='SeeThroughSupports',t[t.InvisibleGuests=2048]='InvisibleGuests',t[t.InvisibleStaff=8388608]='InvisibleStaff',t[t.InvisibleRides=16777218]='InvisibleRides',t[t.InvisibleVehicles=34603008]='InvisibleVehicles',t[t.InvisibleVegetation=69206016]='InvisibleVegetation',t[t.InvisibleScenery=134217732]='InvisibleScenery',t[t.InvisiblePaths=268500992]='InvisiblePaths',t[t.InvisibleSupports=536870920]='InvisibleSupports'})(rn||(rn={}));var an={x:-9e3,y:-9e3};function sn(t){return function(n,e){return new cn(n,e,t)}}var un=rn.HideBase|rn.HideVertical|rn.InvisibleGuests|rn.InvisibleStaff|rn.InvisibleRides|rn.InvisibleVehicles|rn.InvisibleVegetation|rn.InvisibleScenery|rn.InvisiblePaths|rn.SeeThroughSupports,cn=(function(t){function n(n,e,i){var r=t.call(this,'viewport',n,e,i)||this,o=e.binder,a=i.target,s=i.visibilityFlags,u=i.disabled,c=i.zoom,h=function(t){r.aa(t.viewport,a,s,u)};return o.on(r,s,h),o.on(r,u,h),o.on(r,a,h),o.on(r,c,function(t,n){var e=t.viewport;e&&(e.zoom=n)}),e.on('open',function(t){var n=r.da(t);n&&c&&(n.zoom=Ut(c)),r.aa(n,a,s,u)}),(R(a)||T(a))&&e.on('update',function(t){var n=r.da(t);r.aa(n,a,s,u)}),r}return k(n,t),n.prototype.aa=function(t,n,e,i){if(t){var r=this.ba(Ut(n)),o=Ut(e),a=Ut(i);this.ca(t,r,o,a)}},n.prototype.ba=function(t){var n=null;if(!(function(t){return x(t)||I(t)})(t))if(T(t)){var e=map.getEntity(t);e&&(n={x:e.x,y:e.y,z:e.z})}else _(t)&&(n=t);return n},n.prototype.ca=function(t,n,e,i){!i&&n||(e=un,n=an),t.moveTo(n),t.visibilityFlags=e||0},n.prototype.da=function(t){var n=t.getWidget(this.name);return n?n.viewport:null},n})(Qt),hn=new c('window',0);function ln(t,n){if(!t)return hn.error('missing entire GuestDb'),[[],{}];for(var e=[],i={},r=function(t){return h(n,t)},o=0,a=Object.getOwnPropertyNames(t).map(Number);o<a.length;o++){var s=a[o],u=map.getEntity(s);if(p(u)){var c=t[Number(u.id)];i[e.push([u.name,r(c)?c:'unknown'])-1]=u.id}}return 0==e.length&&(e.push(['No one yet','Maybe tomorrow']),i[0]=-1),[e,i]}function fn(t){t.open()}registerPlugin({name:t,version:n,authors:['Brianna Rainey <tassaron>'],type:'remote',licence:'GPL-3.0-only',targetApiVersion:110,main:function(){if('normal'==context.mode){var t=(function(){var t={},n={},e=0,i=context.getParkStorage('food-prefs');return i.has('guests')&&(Object.assign(n,i.getAll('guests')),e=Object.keys(n).length,Object.assign(t,n)),i.set('guests',t),d.info('Loaded '.concat(e,' guests from parkstorage')),t})(),n={guestsIgnoreFavourite:!1,guestsOnlyLike:void 0,showUnresearchedFood:!1},r=new b(120),o=null;context.subscribe('interval.day',function(){r.newDay(t,n),c(t),null===o&&(o=context.setTimeout(function(){!(function(t){for(var n=[],e=0,i=Object.getOwnPropertyNames(t).map(Number);e<i.length;e++){var r=i[e];p(map.getEntity(r))||(d.debug(''.concat(r,' is invalid. removing later')),n.push(r))}if(!(n.length<1)){d.info('deleting invalid IDs found in db ('.concat(n,')'));for(var o=0,a=n;o<a.length;o++)delete t[r=a[o]]}})(t),o=null},3500))}),context.subscribe('action.execute',function(t){return(function(t,n){'ridedemolish'!=n.action&&'ridesetstatus'!=n.action||n.isClientOnly||n.result.error||t.updateStalls()})(r,t)});var a=(function(t,n){var r=function(){var n=ln(t,l);d.set(n[0]),p.set(n[1])},o=function(){l=f(n.showUnresearchedFood?'scenario':'researched')},a=function(){g.set((function(t,n){for(var e=[],i=0,r=0,o=Object.keys(t);r<o.length;r++){var a=o[r];t[a]<1||(h(n,a)?e.push([a,''.concat(t[a],'%')]):i+=t[a])}return 0==e.length&&(i=100),i>0&&e.push([100==i?'no data':'unknown',''.concat(i,'%')]),e})((function(t){for(var n=s.reduce(function(t,n){var i;return e(e({},t),((i={})[n]=0,i))},{}),i=Object.keys(t),r=0,o=i.map(Number);r<o.length;r++)n[t[o[r]]]++;for(var a=0,u=s;a<u.length;a++){var c=u[a];n[c]<1||(n[c]=Math.round(n[c]/i.length*100))}return n})(t),l))};function u(n){Object.assign(t,n),o(),r(),a()}var c=Vt(!0!==n.guestsIgnoreFavourite),l=[];o();var d=Vt([]),p=Vt({});r();var g=Vt([]);a();var v=ln(t,l),y=v[0],w=v[1];d.set(y),p.set(w);var b=Vt(null),m=Vt(!!n.guestsIgnoreFavourite&&n.guestsIgnoreFavourite),k=Vt(!!n.showUnresearchedFood&&n.showUnresearchedFood),I=Vt((function(){for(var t=0;t<s.length;t++)if(s[t]==n.guestsOnlyLike)return t+1;return 0})()),O=(function(t){return x(t.padding)&&(t.padding=5),new Mt(t)})({title:'Food Preferences',width:{value:240,min:180,max:640},height:{value:410,min:410,max:1640},colours:[13,15],content:[qt({text:'Food Preference by Category',content:en({columns:[{header:'Food Name'},{header:'Percent Who Like'}],items:Dt(g,function(){return g.get()})}),height:80}),nn({text:'Food Preference by Guest',content:[en({columns:[{header:'Guest',canSort:!1},{header:'Favourite Item',tooltip:'guest will sometimes buy this item when they otherwise would not'}],items:Dt(d,function(){return d.get()}),onClick:function(n,e){var i=t[p.get()[n]];hn.info('Clicked guest who likes '.concat(i,'.')),b.set(i?n:null)}}),sn({target:Dt(b,function(t){return t?map.getEntity(p.get()[t]):null}),height:100})]}),qt({text:'Cheats',content:Ft({content:[Ct({content:[Yt({text:'Guests only like:',tooltip:'normal guest preference is ignored in favour of the selected option',isChecked:Dt(m,function(){return m.get()}),onChange:function(t){n.guestsIgnoreFavourite=t,m.set(t),c.set(!t),hn.info('cheats.guestsOnlyLike changed to '.concat(t?'true':'false'))}}),$t({items:i(['Everything'],s,!0),disabled:Dt(c,function(){return c.get()}),selectedIndex:Dt(I,function(){return I.get()}),onChange:function(t){hn.info('cheats.guestsOnlyLike changed to '.concat(s[t-1])),I.set(t),n.guestsOnlyLike=t>0?s[t-1]:void 0}})]}),Yt({isChecked:Dt(k,function(){return k.get()}),text:'Show unresearched foods',tooltip:'do not label food \'unknown\' if it is not researched',onChange:function(e){n.showUnresearchedFood=e,k.set(e),hn.info('cheats.showUnresearchedFood changed to '.concat(e?'true':'false')),u(t)}})]}),height:60})]});return[O,u]})(t,n),u=a[0],c=a[1];'undefined'!=typeof ui&&(ui.registerShortcut({id:'food-prefs.openwindow',text:'Open Food Preferences window',bindings:['CTRL+F'],callback:function(){return fn(u)}}),ui.registerMenuItem('Food Preferences',function(){return fn(u)}))}}})})();
